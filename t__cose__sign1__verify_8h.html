<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>t_cose: inc/t_cose/t_cose_sign1_verify.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">t_cose
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bfccd401955b95cf8c75461437045ac0.html">inc</a></li><li class="navelem"><a class="el" href="dir_c790dd4d93afe6413732f56f53ec2af4.html">t_cose</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">t_cose_sign1_verify.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Verify a COSE_Sign1 Message.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &quot;<a class="el" href="q__useful__buf_8h_source.html">t_cose/q_useful_buf.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="t__cose__common_8h_source.html">t_cose/t_cose_common.h</a>&quot;</code><br />
<code>#include &quot;qcbor/qcbor_common.h&quot;</code><br />
</div>
<p><a href="t__cose__sign1__verify_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structt__cose__parameters.html">t_cose_parameters</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a169de8b83e560ed669edf9354dff800e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#a169de8b83e560ed669edf9354dff800e">T_COSE_UNSET_ALGORITHM_ID</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a169de8b83e560ed669edf9354dff800e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad328fd848dd7d1073d561a2257311044"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#ad328fd848dd7d1073d561a2257311044">T_COSE_OPT_ALLOW_SHORT_CIRCUIT</a>&#160;&#160;&#160;0x00000001</td></tr>
<tr class="separator:ad328fd848dd7d1073d561a2257311044"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f24861e9022566e6438d9c2008e6462"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#a2f24861e9022566e6438d9c2008e6462">T_COSE_OPT_REQUIRE_KID</a>&#160;&#160;&#160;0x00000002</td></tr>
<tr class="separator:a2f24861e9022566e6438d9c2008e6462"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a90405104cfdb40a5556f4e2f6ab0350d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#a90405104cfdb40a5556f4e2f6ab0350d">T_COSE_OPT_TAG_REQUIRED</a>&#160;&#160;&#160;0x00000004</td></tr>
<tr class="separator:a90405104cfdb40a5556f4e2f6ab0350d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affd9a42aee707f6420b5989d8f8ba8ad"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#affd9a42aee707f6420b5989d8f8ba8ad">T_COSE_OPT_TAG_PROHIBITED</a>&#160;&#160;&#160;0x00000010</td></tr>
<tr class="separator:affd9a42aee707f6420b5989d8f8ba8ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cb33a6b92d0e94a782f48122949112d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#a2cb33a6b92d0e94a782f48122949112d">T_COSE_OPT_DECODE_ONLY</a>&#160;&#160;&#160;0x00000008</td></tr>
<tr class="separator:a2cb33a6b92d0e94a782f48122949112d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a787602aea3b29cd638ff506921c50495"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#a787602aea3b29cd638ff506921c50495">T_COSE_OPT_UNKNOWN_CRIT_ALLOWED</a>&#160;&#160;&#160;0x00000020</td></tr>
<tr class="separator:a787602aea3b29cd638ff506921c50495"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a0e083f1728e5e46fc28d913e771b4a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#a7a0e083f1728e5e46fc28d913e771b4a">T_COSE_MAX_TAGS_TO_RETURN</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a7a0e083f1728e5e46fc28d913e771b4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa17ffa96916517e6ea735f68f654bf55"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#aa17ffa96916517e6ea735f68f654bf55">t_cose_sign1_verify_init</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context, uint32_t option_flags)</td></tr>
<tr class="memdesc:aa17ffa96916517e6ea735f68f654bf55"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize for <code>COSE_Sign1</code> message verification.  <a href="t__cose__sign1__verify_8h.html#aa17ffa96916517e6ea735f68f654bf55">More...</a><br /></td></tr>
<tr class="separator:aa17ffa96916517e6ea735f68f654bf55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa2559755efcee6aad19cb472dc2461d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#aaa2559755efcee6aad19cb472dc2461d">t_cose_sign1_set_verification_key</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context, struct <a class="el" href="structt__cose__key.html">t_cose_key</a> verification_key)</td></tr>
<tr class="memdesc:aaa2559755efcee6aad19cb472dc2461d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set key for <code>COSE_Sign1</code> message verification.  <a href="t__cose__sign1__verify_8h.html#aaa2559755efcee6aad19cb472dc2461d">More...</a><br /></td></tr>
<tr class="separator:aaa2559755efcee6aad19cb472dc2461d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5e954dddff8f2d6671b90393bf58a35"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#ae5e954dddff8f2d6671b90393bf58a35">t_cose_sign1_verify_set_auxiliary_buffer</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context, struct q_useful_buf auxiliary_buffer)</td></tr>
<tr class="memdesc:ae5e954dddff8f2d6671b90393bf58a35"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configure a buffer used to serialize the Sig_Structure.  <a href="t__cose__sign1__verify_8h.html#ae5e954dddff8f2d6671b90393bf58a35">More...</a><br /></td></tr>
<tr class="separator:ae5e954dddff8f2d6671b90393bf58a35"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a3b69b76f045df2797693e89b08d484"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#a3a3b69b76f045df2797693e89b08d484">t_cose_sign1_verify_auxiliary_buffer_size</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context)</td></tr>
<tr class="memdesc:a3a3b69b76f045df2797693e89b08d484"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the required auxiliary buffer size for the most recent verification operation.  <a href="t__cose__sign1__verify_8h.html#a3a3b69b76f045df2797693e89b08d484">More...</a><br /></td></tr>
<tr class="separator:a3a3b69b76f045df2797693e89b08d484"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab14a59bbe3e640de21ea4f8e34abf3c9"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9">t_cose_sign1_verify</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context, struct q_useful_buf_c sign1, struct q_useful_buf_c *payload, struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *parameters)</td></tr>
<tr class="memdesc:ab14a59bbe3e640de21ea4f8e34abf3c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify a <code>COSE_Sign1</code>.  <a href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9">More...</a><br /></td></tr>
<tr class="separator:ab14a59bbe3e640de21ea4f8e34abf3c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd75fb94e37e3254bb02e7c34134f0b7"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#abd75fb94e37e3254bb02e7c34134f0b7">t_cose_sign1_verify_aad</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context, struct q_useful_buf_c sign1, struct q_useful_buf_c aad, struct q_useful_buf_c *payload, struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *parameters)</td></tr>
<tr class="memdesc:abd75fb94e37e3254bb02e7c34134f0b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify a COSE_Sign1 with Additional Authenticated Data.  <a href="t__cose__sign1__verify_8h.html#abd75fb94e37e3254bb02e7c34134f0b7">More...</a><br /></td></tr>
<tr class="separator:abd75fb94e37e3254bb02e7c34134f0b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a70be60718c904dea54596e8e807b69"><td class="memItemLeft" align="right" valign="top">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#a6a70be60718c904dea54596e8e807b69">t_cose_sign1_verify_detached</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context, struct q_useful_buf_c cose_sign1, struct q_useful_buf_c aad, struct q_useful_buf_c detached_payload, struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *parameters)</td></tr>
<tr class="memdesc:a6a70be60718c904dea54596e8e807b69"><td class="mdescLeft">&#160;</td><td class="mdescRight">Verify a COSE_Sign1 with detached payload.  <a href="t__cose__sign1__verify_8h.html#a6a70be60718c904dea54596e8e807b69">More...</a><br /></td></tr>
<tr class="separator:a6a70be60718c904dea54596e8e807b69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8be686d6c16bb92cf6b99c9630f47d07"><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#a8be686d6c16bb92cf6b99c9630f47d07">t_cose_sign1_get_nth_tag</a> (const struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *context, size_t n)</td></tr>
<tr class="memdesc:a8be686d6c16bb92cf6b99c9630f47d07"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return unprocessed tags from most recent signature verify.  <a href="t__cose__sign1__verify_8h.html#a8be686d6c16bb92cf6b99c9630f47d07">More...</a><br /></td></tr>
<tr class="separator:a8be686d6c16bb92cf6b99c9630f47d07"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac04166c4f43e9437bdb3a0894ebc933d"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="t__cose__sign1__verify_8h.html#ac04166c4f43e9437bdb3a0894ebc933d">t_cose_sign1_verify_internal</a> (struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *me, struct q_useful_buf_c sign1, struct q_useful_buf_c aad, struct q_useful_buf_c *payload, struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *parameters, bool is_detached)</td></tr>
<tr class="memdesc:ac04166c4f43e9437bdb3a0894ebc933d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Semi-private function to verify a COSE_Sign1.  <a href="t__cose__sign1__verify_8h.html#ac04166c4f43e9437bdb3a0894ebc933d">More...</a><br /></td></tr>
<tr class="separator:ac04166c4f43e9437bdb3a0894ebc933d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Verify a COSE_Sign1 Message. </p>
<p>This verifies a <code>COSE_Sign1</code> message in compliance with <a href="https://tools.ietf.org/html/rfc8152">COSE (RFC 8152)</a>. A <code>COSE_Sign1</code> message is a CBOR encoded binary blob that contains header parameters, a payload and a signature. Usually the signature is made with an EC signing algorithm like ECDSA.</p>
<p>This implementation is intended to be small and portable to different OS's and platforms. Its dependencies are:</p><ul>
<li><a href="https://github.com/laurencelundblade/QCBOR">QCBOR</a></li>
<li>&lt;stdint.h&gt;, &lt;string.h&gt;, &lt;stddef.h&gt;</li>
<li>Hash functions like SHA-256</li>
<li>Signing functions like ECDSA</li>
</ul>
<p>There is a cryptographic adaptation layer defined in t_cose_crypto.h. An implementation can be made of the functions in it for different cryptographic libraries. This means that different integrations with different cryptographic libraries may support only signing with a particular set of algorithms. Integration with <a href="https://www.openssl.org">OpenSSL</a> is supported. Key ID look up also varies by different cryptographic library integrations.</p>
<p>See <a class="el" href="t__cose__common_8h.html" title="This file contains definitions common to all public t_cose interfaces.">t_cose_common.h</a> for preprocessor defines to reduce object code and stack use by disabling features. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a7a0e083f1728e5e46fc28d913e771b4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a0e083f1728e5e46fc28d913e771b4a">&#9670;&nbsp;</a></span>T_COSE_MAX_TAGS_TO_RETURN</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define T_COSE_MAX_TAGS_TO_RETURN&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The maximum number of unprocessed tags that can be returned by <a class="el" href="t__cose__sign1__verify_8h.html#a8be686d6c16bb92cf6b99c9630f47d07" title="Return unprocessed tags from most recent signature verify.">t_cose_sign1_get_nth_tag()</a>. The CWT tag is an example of the tags that might returned. The COSE tags that are processed, don't count here. </p>

</div>
</div>
<a id="ad328fd848dd7d1073d561a2257311044"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad328fd848dd7d1073d561a2257311044">&#9670;&nbsp;</a></span>T_COSE_OPT_ALLOW_SHORT_CIRCUIT</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define T_COSE_OPT_ALLOW_SHORT_CIRCUIT&#160;&#160;&#160;0x00000001</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Pass this as <code>option_flags</code> to allow verification of short-circuit signatures. This should only be used as a test mode as short-circuit signatures are not secure.</p>
<p>See also <a class="el" href="t__cose__sign1__sign_8h.html#a83d4e7ad0c4ada63f17d4b1e8fa0cc56">T_COSE_OPT_SHORT_CIRCUIT_SIG</a>. </p>

</div>
</div>
<a id="a2cb33a6b92d0e94a782f48122949112d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2cb33a6b92d0e94a782f48122949112d">&#9670;&nbsp;</a></span>T_COSE_OPT_DECODE_ONLY</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define T_COSE_OPT_DECODE_ONLY&#160;&#160;&#160;0x00000008</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>See <a class="el" href="t__cose__sign1__verify_8h.html#aaa2559755efcee6aad19cb472dc2461d" title="Set key for COSE_Sign1 message verification.">t_cose_sign1_set_verification_key()</a>.</p>
<p>This option disables cryptographic signature verification. With this option the <code>verification_key</code> is not needed. This is useful to decode the <code>COSE_Sign1</code> message to get the kid (key ID). The verification key can be looked up or otherwise obtained by the caller. Once the key in in hand, <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a> can be called again to perform the full verification.</p>
<p>The payload will always be returned whether this is option is given or not, but it should not be considered secure when this option is given. </p>

</div>
</div>
<a id="a2f24861e9022566e6438d9c2008e6462"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f24861e9022566e6438d9c2008e6462">&#9670;&nbsp;</a></span>T_COSE_OPT_REQUIRE_KID</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define T_COSE_OPT_REQUIRE_KID&#160;&#160;&#160;0x00000002</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The error <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97a23a974983ca9295bbd4a6b7f000d6c25">T_COSE_ERR_NO_KID</a> is returned if the kid parameter is missing. Note that the kid parameter is primarily passed on to the crypto layer so the crypto layer can look up the key. If the verification key is determined by other than the kid, then it is fine if there is no kid. </p>

</div>
</div>
<a id="affd9a42aee707f6420b5989d8f8ba8ad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affd9a42aee707f6420b5989d8f8ba8ad">&#9670;&nbsp;</a></span>T_COSE_OPT_TAG_PROHIBITED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define T_COSE_OPT_TAG_PROHIBITED&#160;&#160;&#160;0x00000010</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Normally this will decode the CBOR presented as a <code>COSE_Sign1</code> message whether it is tagged using QCBOR tagging as such or not. If this option is set, then <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97a7a9a9b13e67d007b3e7ca588673fca5e">T_COSE_ERR_INCORRECTLY_TAGGED</a> is returned if a CBOR_TAG_COSE_SIGN1 tag. When this option is set the caller knows for certain that a COSE signed message is expected.</p>
<p>See discussion on <a class="el" href="t__cose__sign1__verify_8h.html#a90405104cfdb40a5556f4e2f6ab0350d">T_COSE_OPT_TAG_REQUIRED</a>. </p>

</div>
</div>
<a id="a90405104cfdb40a5556f4e2f6ab0350d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90405104cfdb40a5556f4e2f6ab0350d">&#9670;&nbsp;</a></span>T_COSE_OPT_TAG_REQUIRED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define T_COSE_OPT_TAG_REQUIRED&#160;&#160;&#160;0x00000004</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Normally this will decode the CBOR presented as a <code>COSE_Sign1</code> message whether it is tagged using QCBOR tagging as such or not. If this option is set, then <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97a7a9a9b13e67d007b3e7ca588673fca5e">T_COSE_ERR_INCORRECTLY_TAGGED</a> is returned if it is not a CBOR_TAG_COSE_SIGN1 tag.</p>
<p>See also <a class="el" href="t__cose__sign1__verify_8h.html#affd9a42aee707f6420b5989d8f8ba8ad">T_COSE_OPT_TAG_PROHIBITED</a>. If neither this or <a class="el" href="t__cose__sign1__verify_8h.html#affd9a42aee707f6420b5989d8f8ba8ad">T_COSE_OPT_TAG_PROHIBITED</a> is set then the content can either be COSE message (COSE_Sign1 CDDL from RFC 8152) or a COSESign1 tagg (COSE_Sign1_Tagged from RFC 8152).</p>
<p>See <a class="el" href="t__cose__sign1__verify_8h.html#a8be686d6c16bb92cf6b99c9630f47d07" title="Return unprocessed tags from most recent signature verify.">t_cose_sign1_get_nth_tag()</a> to get further tags that enclose the COSE message. </p>

</div>
</div>
<a id="a787602aea3b29cd638ff506921c50495"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a787602aea3b29cd638ff506921c50495">&#9670;&nbsp;</a></span>T_COSE_OPT_UNKNOWN_CRIT_ALLOWED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define T_COSE_OPT_UNKNOWN_CRIT_ALLOWED&#160;&#160;&#160;0x00000020</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This option disables verification that critical header parameters are known.</p>
<p>Without this flag set, an error is raised during verification if there is an unknown header parameter in the critical header parameters list. However, if this flag is set then that part of verification is skipped. </p>

</div>
</div>
<a id="a169de8b83e560ed669edf9354dff800e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a169de8b83e560ed669edf9354dff800e">&#9670;&nbsp;</a></span>T_COSE_UNSET_ALGORITHM_ID</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define T_COSE_UNSET_ALGORITHM_ID&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>A special COSE algorithm ID that indicates no COSE algorithm ID or an unset COSE algorithm ID. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a8be686d6c16bb92cf6b99c9630f47d07"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8be686d6c16bb92cf6b99c9630f47d07">&#9670;&nbsp;</a></span>t_cose_sign1_get_nth_tag()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint64_t t_cose_sign1_get_nth_tag </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return unprocessed tags from most recent signature verify. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">context</td><td>The t_cose signature verification context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Index of the tag to return.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The tag value or CBOR_TAG_INVALID64 if there is no tag at the index or the index is too large.</dd></dl>
<p>The 0th tag is the one for which the COSE message is the content. Loop from 0 up until CBOR_TAG_INVALID64 is returned. The maximum is <a class="el" href="t__cose__sign1__verify_8h.html#a7a0e083f1728e5e46fc28d913e771b4a">T_COSE_MAX_TAGS_TO_RETURN</a>.</p>
<p>It will be necessary to call this for a general implementation of a CWT since sometimes the CWT tag is required. This is also needed for recursive processing of nested COSE signing and/or encryption. </p>

</div>
</div>
<a id="aaa2559755efcee6aad19cb472dc2461d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa2559755efcee6aad19cb472dc2461d">&#9670;&nbsp;</a></span>t_cose_sign1_set_verification_key()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void t_cose_sign1_set_verification_key </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structt__cose__key.html">t_cose_key</a>&#160;</td>
          <td class="paramname"><em>verification_key</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Set key for <code>COSE_Sign1</code> message verification. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">context</td><td>The t_cose signature verification context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">verification_key</td><td>The verification key to use.</td></tr>
  </table>
  </dd>
</dl>
<p>There are four ways that the verification key is found and supplied to t_cose so that <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a> succeeds.</p>
<ol type="1">
<li>Look up by kid parameter and set by <a class="el" href="t__cose__sign1__verify_8h.html#aaa2559755efcee6aad19cb472dc2461d" title="Set key for COSE_Sign1 message verification.">t_cose_sign1_set_verification_key()</a></li>
<li>Look up by other and set by <a class="el" href="t__cose__sign1__verify_8h.html#aaa2559755efcee6aad19cb472dc2461d" title="Set key for COSE_Sign1 message verification.">t_cose_sign1_set_verification_key()</a></li>
<li>Determination by kid that short circuit signing is used (test only)</li>
<li>Look up by kid parameter in cryptographic adaptation layer</li>
</ol>
<p>Note that there is no means where certificates, like X.509 certificates, are provided in the COSE parameters. Perhaps there will be in the future but that is not in common use or supported by this implementation.</p>
<p>To use 1, it is necessary to call <a class="el" href="t__cose__sign1__verify_8h.html#aa17ffa96916517e6ea735f68f654bf55" title="Initialize for COSE_Sign1 message verification.">t_cose_sign1_verify_init()</a> and <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a> twice. The first time <a class="el" href="t__cose__sign1__verify_8h.html#aa17ffa96916517e6ea735f68f654bf55" title="Initialize for COSE_Sign1 message verification.">t_cose_sign1_verify_init()</a> is called, give the <a class="el" href="t__cose__sign1__verify_8h.html#a2cb33a6b92d0e94a782f48122949112d">T_COSE_OPT_DECODE_ONLY</a> option. Then call <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a> and the kid will be returned in <code>parameters</code>. The caller finds the kid on their own. Then call this to set the key. Last call <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a>, again without the <a class="el" href="t__cose__sign1__verify_8h.html#a2cb33a6b92d0e94a782f48122949112d">T_COSE_OPT_DECODE_ONLY</a> option.</p>
<p>To use 2, the key is somehow determined without the kid and <a class="el" href="t__cose__sign1__verify_8h.html#aaa2559755efcee6aad19cb472dc2461d" title="Set key for COSE_Sign1 message verification.">t_cose_sign1_set_verification_key()</a> is called with it. Then <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a> is called. Note that this implementation cannot return non-standard header parameters, at least not yet.</p>
<p>To use 3, initialize with <a class="el" href="t__cose__sign1__verify_8h.html#ad328fd848dd7d1073d561a2257311044">T_COSE_OPT_ALLOW_SHORT_CIRCUIT</a>. No call to <a class="el" href="t__cose__sign1__verify_8h.html#aaa2559755efcee6aad19cb472dc2461d" title="Set key for COSE_Sign1 message verification.">t_cose_sign1_set_verification_key()</a> is necessary. If you do call <a class="el" href="t__cose__sign1__verify_8h.html#aaa2559755efcee6aad19cb472dc2461d" title="Set key for COSE_Sign1 message verification.">t_cose_sign1_set_verification_key()</a>, the kid for short circuit signing will be recognized and the set key will be ignored.</p>
<p>To use 4, first be sure that the cryptographic adapter supports look up by kid. There's no API to determine this, so it is probably determined by other system documentation (aka source code). In this mode, all that is necessary is to call <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a>.</p>
<p>3 always works no matter what is done in the cryptographic adaptation layer because it never calls out to it. The OpenSSL adaptor supports 1 and 2. </p>

</div>
</div>
<a id="ab14a59bbe3e640de21ea4f8e34abf3c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab14a59bbe3e640de21ea4f8e34abf3c9">&#9670;&nbsp;</a></span>t_cose_sign1_verify()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_verify </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>sign1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *&#160;</td>
          <td class="paramname"><em>parameters</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Verify a <code>COSE_Sign1</code>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">context</td><td>The t_cose signature verification context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sign1</td><td>Pointer and length of CBOR encoded <code>COSE_Sign1</code> message that is to be verified. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">payload</td><td>Pointer and length of the payload. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">parameters</td><td>Place to return parsed parameters. May be <code>NULL</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This returns one of the error codes defined by <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>.</dd></dl>
<p>See <a class="el" href="t__cose__sign1__verify_8h.html#aaa2559755efcee6aad19cb472dc2461d" title="Set key for COSE_Sign1 message verification.">t_cose_sign1_set_verification_key()</a> for discussion on where the verification key comes from.</p>
<p>Verification involves the following steps.</p>
<ul>
<li>The CBOR-format <code>COSE_Sign1</code> structure is parsed. This makes sure <code>COSE_Sign1</code> is valid CBOR and follows the required structure for <code>COSE_Sign1</code>.</li>
<li>The protected header parameters are decoded, particular the algorithm id.</li>
<li>The unprotected headers parameters are decoded, particularly the kid.</li>
<li>The payload is identified. The internals of the payload are not decoded.</li>
<li>The expected hash, the "to-be-signed" bytes are computed. The hash algorithm used comes from the signing algorithm. If the algorithm is unknown or not supported this will error out.</li>
<li>Finally, the signature verification is performed.</li>
</ul>
<p>If verification is successful, the pointer to the CBOR-encoded payload is returned. The parameters are returned if requested. All pointers returned are to memory in the <code>sign1</code> passed in.</p>
<p>Note that this only handles standard COSE header parameters. There are no facilities for custom header parameters, even though they are allowed by the COSE standard.</p>
<p>This will recognize the special key ID for short-circuit signing and verify it if the <a class="el" href="t__cose__sign1__verify_8h.html#ad328fd848dd7d1073d561a2257311044">T_COSE_OPT_ALLOW_SHORT_CIRCUIT</a> is set.</p>
<p>Indefinite length CBOR strings are not supported by this implementation. <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97a3b506bca4791f5bdeeb46a84d13098a6">T_COSE_ERR_SIGN1_FORMAT</a> will be returned if they are in the input <code>COSE_Sign1</code> messages. For example, if the payload is an indefinite-length byte string, this error will be returned. </p>

</div>
</div>
<a id="abd75fb94e37e3254bb02e7c34134f0b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd75fb94e37e3254bb02e7c34134f0b7">&#9670;&nbsp;</a></span>t_cose_sign1_verify_aad()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_verify_aad </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>sign1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>aad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *&#160;</td>
          <td class="paramname"><em>parameters</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Verify a COSE_Sign1 with Additional Authenticated Data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">context</td><td>The t_cose signature verification context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sign1</td><td>Pointer and length of CBOR encoded <code>COSE_Sign1</code> message that is to be verified. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">aad</td><td>The Additional Authenticated Data or <code>NULL_Q_USEFUL_BUF_C</code>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">payload</td><td>Pointer and length of the payload. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">parameters</td><td>Place to return parsed parameters. May be <code>NULL</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This returns one of the error codes defined by <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>.</dd></dl>
<p>This is just like <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a>, but allows passing AAD (Additional Authenticated Data) for verification.</p>
<p>AAD is some additional bytes that are covered by the signature in addition to the payload. They may be any bytes, but are often some options or commands that are sent along with the <code>COSE_Sign1</code>. If a <code>COSE_Sign1</code> was created with AAD, that AAD must be passed in here to successfully verify the signature. If it is not, a <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97a5629e71ec5fce4c867421b014481fb22">T_COSE_ERR_SIG_VERIFY</a> will occur. There is no indication in the <code>COSE_Sign1</code> to know whether there was AAD input when it was created. It has to be known by context.</p>
<p>Calling this with <code>aad</code> as <code>NULL_Q_USEFUL_BUF_C</code> is the same as calling <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a>. </p>

</div>
</div>
<a id="a3a3b69b76f045df2797693e89b08d484"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a3b69b76f045df2797693e89b08d484">&#9670;&nbsp;</a></span>t_cose_sign1_verify_auxiliary_buffer_size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static size_t t_cose_sign1_verify_auxiliary_buffer_size </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the required auxiliary buffer size for the most recent verification operation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">context</td><td>The t_cose signature verification context.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of bytes of auxiliary buffer used by the most recent verification operation.</dd></dl>
<p>This function can be called after <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9">t_cose_sign1_verify</a> (or equivalent) was called. If the context was initialized with the DECODE_ONLY flag, it returns the number of bytes that would have been used by the signing operation. This allows the caller to allocate an appropriately sized buffer before performing the actual verification.</p>
<p>This function returns zero if the signature algorithm used does not need an auxiliary buffer. </p>

</div>
</div>
<a id="a6a70be60718c904dea54596e8e807b69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6a70be60718c904dea54596e8e807b69">&#9670;&nbsp;</a></span>t_cose_sign1_verify_detached()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_verify_detached </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>cose_sign1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>aad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>detached_payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *&#160;</td>
          <td class="paramname"><em>parameters</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Verify a COSE_Sign1 with detached payload. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">context</td><td>The t_cose signature verification context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cose_sign1</td><td>Pointer and length of CBOR encoded <code>COSE_Sign1</code> message that is to be verified. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">aad</td><td>The Additional Authenticated Data or <code>NULL_Q_USEFUL_BUF_C</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">detached_payload</td><td>Pointer and length of the payload. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">parameters</td><td>Place to return parsed parameters. May be <code>NULL</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This returns one of the error codes defined by <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>.</dd></dl>
<p>A detached payload is one that is not inside the <code>COSE_Sign1</code>, but is conveyed separately. It is still covered by the signature exactly as if it was the payload inside the <code>COSE_Sign1</code>.</p>
<p>This function is the same as <a class="el" href="t__cose__sign1__verify_8h.html#abd75fb94e37e3254bb02e7c34134f0b7" title="Verify a COSE_Sign1 with Additional Authenticated Data.">t_cose_sign1_verify_aad()</a>, but for use with a detached payload. Instead of the payload being returned, it must be passed in as it must have arrived separately from the <code>COSE_Sign1</code>. The signature covers it so it must be passed in to complete the verification.</p>
<p><code>aad</code> may be <code>NULL_Q_USEFUL_BUF_C</code> if there is no AAD. </p>

</div>
</div>
<a id="aa17ffa96916517e6ea735f68f654bf55"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa17ffa96916517e6ea735f68f654bf55">&#9670;&nbsp;</a></span>t_cose_sign1_verify_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void t_cose_sign1_verify_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>option_flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize for <code>COSE_Sign1</code> message verification. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">context</td><td>The context to initialize. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">option_flags</td><td>Options controlling the verification.</td></tr>
  </table>
  </dd>
</dl>
<p>This must be called before using the verification context. </p>

</div>
</div>
<a id="ac04166c4f43e9437bdb3a0894ebc933d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac04166c4f43e9437bdb3a0894ebc933d">&#9670;&nbsp;</a></span>t_cose_sign1_verify_internal()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> t_cose_sign1_verify_internal </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>me</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>sign1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c&#160;</td>
          <td class="paramname"><em>aad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf_c *&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structt__cose__parameters.html">t_cose_parameters</a> *&#160;</td>
          <td class="paramname"><em>parameters</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>is_detached</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Semi-private function to verify a COSE_Sign1. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">me</td><td>The t_cose signature verification context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sign1</td><td>Pointer and length of CBOR encoded <code>COSE_Sign1</code> message that is to be verified. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">aad</td><td>The Additional Authenticated Data or <code>NULL_Q_USEFUL_BUF_C</code>. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">payload</td><td>Pointer and length of the payload. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">parameters</td><td>Place to return parsed parameters. May be <code>NULL</code>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">is_detached</td><td>Indicates the payload is detached.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This returns one of the error codes defined by <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>.</dd></dl>
<p>This does the work for <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9" title="Verify a COSE_Sign1.">t_cose_sign1_verify()</a>, <a class="el" href="t__cose__sign1__verify_8h.html#abd75fb94e37e3254bb02e7c34134f0b7" title="Verify a COSE_Sign1 with Additional Authenticated Data.">t_cose_sign1_verify_aad()</a> and <a class="el" href="t__cose__sign1__verify_8h.html#a6a70be60718c904dea54596e8e807b69" title="Verify a COSE_Sign1 with detached payload.">t_cose_sign1_verify_detached()</a>. It is a semi-private function which means its interface isn't guaranteed so it should not to call it directly. </p>

</div>
</div>
<a id="ae5e954dddff8f2d6671b90393bf58a35"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5e954dddff8f2d6671b90393bf58a35">&#9670;&nbsp;</a></span>t_cose_sign1_verify_set_auxiliary_buffer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void t_cose_sign1_verify_set_auxiliary_buffer </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structt__cose__sign1__verify__ctx.html">t_cose_sign1_verify_ctx</a> *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct q_useful_buf&#160;</td>
          <td class="paramname"><em>auxiliary_buffer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Configure a buffer used to serialize the Sig_Structure. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">context</td><td>The t_cose signature verification context. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">auxiliary_buffer</td><td>The auxiliary buffer to be used.</td></tr>
  </table>
  </dd>
</dl>
<p>Some signature algorithms (namely EdDSA), require two passes over their input. In order to achieve this, the library needs to serialize a temporary to-be-signed structure into an auxiliary buffer. This function allows the user to configure such a buffer.</p>
<p>The buffer must be big enough to accomodate the Sig_Structure type, which is roughly the sum of sizes of the encoded protected parameters, aad and payload, along with a few dozen bytes of overhead.</p>
<p>To compute the exact size needed, initialize the context with the <a class="el" href="t__cose__sign1__verify_8h.html#a2cb33a6b92d0e94a782f48122949112d">T_COSE_OPT_DECODE_ONLY</a> option, and call the <a class="el" href="t__cose__sign1__verify_8h.html#ab14a59bbe3e640de21ea4f8e34abf3c9">t_cose_sign1_verify</a> (or similar). After the message decoding, the necessary auxiliary buffer size is available by calling <a class="el" href="t__cose__sign1__verify_8h.html#a3a3b69b76f045df2797693e89b08d484">t_cose_sign1_verify_auxiliary_buffer_size</a>. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
